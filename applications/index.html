<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Application Papers Explorer</title>

    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/2.0.8/css/dataTables.dataTables.min.css">

    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h1 { color: #333; }
        p { margin-bottom: 20px; } /* Add some space below the paragraph */

        #paperTable {
            width: 100% !important; /* Ensure DataTables respects 100% width with scrollX */
            border-collapse: collapse;
            margin-top: 15px; /* Add some space above the table */
        }
        #paperTable th, #paperTable td {
            border: 1px solid #ddd;
            padding: 4px 8px; /* Reduced vertical padding, standard horizontal */
            text-align: left;
            font-size: 0.9em; /* Slightly smaller font size for compactness */
            white-space: nowrap; /* Prevent text wrapping in cells by default if too wide */
        }
        #paperTable th {
            background-color: #f2f2f2;
            font-weight: bold;
        }

        /* Styling for the horizontal scrollbar introduced by DataTables scrollX */
        .dataTables_scrollBody {
            border-bottom: 1px solid #ddd;
        }
        /* Make the global search input and pagination controls a bit more spaced */
        .dataTables_wrapper .dataTables_filter,
        .dataTables_wrapper .dataTables_paginate {
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <h1>ðŸ”¬ Application Papers Exploratory Framework</h1>
    <p>Explore and filter the harmonized weak annotation pool for 'application' type papers directly in your browser.</p>

    <table id="paperTable" class="display compact" style="width:100%">
        <thead>
            <tr>
                </tr>
        </thead>
        <tbody>
            </tbody>
    </table>

    <script type="text/javascript" src="https://code.jquery.com/jquery-3.7.1.min.js"></script>

    <script type="text/javascript" src="https://cdn.datatables.net/2.0.8/js/dataTables.min.js"></script>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/PapaParse/5.4.1/papaparse.min.js"></script>

    <script type="text/javascript">
        // Function to dynamically get the base path for assets on GitHub Pages
        // This function helps your script find files correctly whether on a root domain
        // or in a GitHub Pages project subfolder (like /solr/).
        function getGithubPagesBasePath() {
            const pathname = window.location.pathname;
            const parts = pathname.split('/');
            // If the URL is like 'https://username.github.io/repo-name/...'
            // then parts[1] will be 'repo-name'.
            // If it's 'https://username.github.io/', parts[1] will be empty.
            if (parts.length > 1 && parts[1] !== '') {
                return '/' + parts[1];
            }
            return ''; // For user pages (username.github.io)
        }

        $(document).ready(function() {
            const basePath = getGithubPagesBasePath();

            // --- CRITICAL: Verify this path matches the EXACT location of your CSV on GitHub.com ---
            //
            // Option A: If your CSV is in 'your-repo/docs/data/' (recommended structure)
            const csvFilePath = `${basePath}/data/weak_annotation_pool_application_papers_harmonized.csv`;

            // Option B: If your CSV is directly in 'your-repo/docs/'
            // const csvFilePath = `${basePath}/weak_annotation_pool_application_papers_harmonized.csv`;

            console.log("Attempting to load CSV from:", csvFilePath);

            function loadCsvAndInitializeTable() {
                Papa.parse(csvFilePath, {
                    download: true,       // Tell PapaParse to fetch the file from the URL
                    header: true,         // Treat the first row as column headers (returns an array of objects)
                    skipEmptyLines: true, // Ignore any empty rows in the CSV
                    complete: function(results) {
                        // Check for any parsing errors reported by PapaParse
                        if (results.errors.length > 0) {
                            console.error("PapaParse errors:", results.errors);
                            alert("Error parsing CSV data. Please check the CSV file for issues (e.g., malformed lines).");
                            return;
                        }

                        // `results.meta.fields` gives us an ordered array of the column names as found in the CSV header.
                        const headers = results.meta.fields;

                        // `results.data` is an array of objects, where each object is a row
                        // with column names as keys (e.g., { "DOI": "10.123/abc", "Title": "Paper A" }).
                        // DataTables can work directly with this format using the `columns.data` option,
                        // but for simplicity, we convert it to an array of arrays here, maintaining order.
                        const data = results.data.map(row => {
                            // Ensure data order matches header order for DataTables
                            return headers.map(header => row[header]);
                        });

                        // Initialize DataTables
                        $('#paperTable').DataTable({
                            data: data, // Your parsed CSV data
                            columns: headers.map(header => ({ title: header })), // Use PapaParse's headers for table columns

                            paging: true,     // Enable pagination
                            searching: true,  // Enable the global search box
                            ordering: true,   // Enable column sorting
                            info: true,       // Show "Showing X of Y entries" info

                            // --- Table Sizing and Scroll (to fit screen) ---
                            scrollX: true,    // Add horizontal scrollbar if table content is wider than screen
                            autoWidth: false, // Prevents DataTables from trying to perfectly fit columns, better with scrollX

                            // --- Column Hiding ---
                            columnDefs: [
                                { targets: headers.indexOf('is_method_paper'), visible: false },
                                { targets: headers.indexOf('is_method_comparison_paper'), visible: false },
                                { targets: headers.indexOf('review_type'), visible: false },
                                { targets: headers.indexOf('methodology_type'), visible: false },
                                { targets: headers.indexOf('pipeline_package_name'), visible: false },
                                { targets: headers.indexOf('main_goals'), visible: false },
                                { targets: headers.indexOf('data_links_mentioned'), visible: false },
                                { targets: headers.indexOf('code_availability.status'), visible: false },
                                { targets: headers.indexOf('code_availability.link_in_abstract_or_title'), visible: false },
                                { targets: headers.indexOf('is_disease_specific_review'), visible: false },
                                { targets: headers.indexOf('is_pipeline_paper'), visible: false },
                                { targets: headers.indexOf('is_review_paper'), visible: false }
                            ]
                        });

                        console.log("Table initialized successfully with specified columns hidden and horizontal scroll enabled.");
                        console.log("The global search box should now work correctly across all VISIBLE columns.");
                    },
                    error: function(err, file, inputElem, reason) {
                        // This callback is for network errors or file not found before parsing begins
                        console.error("PapaParse loading error:", err, reason);
                        alert("Error loading CSV file. Please check the console for network errors (e.g., 404 Not Found).");
                    }
                });
            }

            loadCsvAndInitializeTable(); // Call the function to load CSV and initialize the table
        });
    </script>
</body>
</html>